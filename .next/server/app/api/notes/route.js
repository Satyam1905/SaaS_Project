"use strict";(()=>{var e={};e.id=175,e.ids=[175],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5127:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>p});var s=r(9303),a=r(8716),o=r(670),i=r(7070),u=r(650),d=r(9178),l=r(2663);async function c(e){try{let t=(0,u.L)(e);if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=d.e.verifyToken(t),n=await l._.note.findMany({where:{tenantId:r.tenantId},include:{author:{select:{email:!0}}},orderBy:{createdAt:"desc"}});return i.NextResponse.json({success:!0,data:n})}catch(e){return i.NextResponse.json({success:!1,error:"Failed to fetch notes"},{status:500})}}async function p(e){try{let t=(0,u.L)(e);if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=d.e.verifyToken(t);if("ADMIN"!==r.role){let e=await l._.tenant.findUnique({where:{id:r.tenantId},include:{_count:{select:{notes:!0}}}});if(e?.plan==="FREE"&&e._count.notes>=3)return i.NextResponse.json({success:!1,error:"Free plan limit reached. Upgrade to PRO."},{status:403})}let{title:n,content:s}=await e.json();if(!n)return i.NextResponse.json({success:!1,error:"Title is required"},{status:400});let a=await l._.note.create({data:{title:n,content:s,tenantId:r.tenantId,authorId:r.userId}});return i.NextResponse.json({success:!0,data:a},{status:201})}catch(e){return i.NextResponse.json({success:!1,error:"Failed to create note"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/notes/route",pathname:"/api/notes",filename:"route",bundlePath:"app/api/notes/route"},resolvedPagePath:"C:\\Users\\satyam patel\\Downloads\\saas_assignment\\saas-notes-app\\app\\api\\notes\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:x}=h,j="/api/notes/route";function w(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},9178:(e,t,r)=>{r.d(t,{e:()=>d});var n=r(1482),s=r.n(n),a=r(2023),o=r.n(a),i=r(2663);let u="y48wje903jfe3jed90e4949t493jfe3jed90e4949t49";class d{static async login(e,t){let r=await i._.user.findUnique({where:{email:e},include:{tenant:!0}});if(!r||!await o().compare(t,r.password))throw Error("Invalid credentials");let n={userId:r.id,tenantId:r.tenantId,role:r.role,email:r.email},a=s().sign(n,u,{expiresIn:"7d"});return{user:{id:r.id,email:r.email,role:r.role,tenantId:r.tenantId},token:a,tenant:r.tenant}}static verifyToken(e){try{return s().verify(e,u)}catch(e){throw Error("Invalid token")}}}},2663:(e,t,r)=>{r.d(t,{_:()=>s});let n=require("@prisma/client"),s=globalThis.prisma??new n.PrismaClient},650:(e,t,r)=>{function n(e){let t=e.headers.get("authorization");return t?.startsWith("Bearer ")?t.slice(7):null}r.d(t,{L:()=>n})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,944],()=>r(5127));module.exports=n})();